import{j as e}from"../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{yupResolver as o}from"../node_modules/.pnpm/@hookform_resolvers@3.3.4_react-hook-form@7.50.1/node_modules/@hookform/resolvers/yup/dist/yup.js";import{Stack as t}from"@mui/material";import r,{useState as i,useMemo as m}from"react";import{useForm as s}from"../node_modules/.pnpm/react-hook-form@7.50.1_react@18.2.0/node_modules/react-hook-form/dist/index.esm.js";import*as n from"yup";import"../components/image/image.js";import"../components/iconify/iconify.js";import"../components/upload/upload-drag/cropModal.js";import"../node_modules/.pnpm/mui-one-time-password-input@2.0.2_@emotion_react@11.11.3_@emotion_styled@11.11.0_@mui_materia_zfj6k7f6yfwygnu6ebtjrsucvm/node_modules/mui-one-time-password-input/dist/mui-one-time-password-input.es.js";import"../components/editor/index.js";import"../utils/highlight.js";import"../node_modules/.pnpm/numeral@2.0.6/node_modules/numeral/numeral.js";import"../utils/myDay.js";import{useGetField as a}from"./use-get-field.js";import"../node_modules/.pnpm/react-google-autocomplete@2.7.3_react@18.2.0/node_modules/react-google-autocomplete/lib/usePlacesAutocompleteService.js";import{uuidv4 as l}from"../utils/uuidv4.js";import u from"../components/form/form-provider.js";import d from"../node_modules/.pnpm/@mui_material@5.15.10_@emotion_react@11.11.3_@emotion_styled@11.11.0_@types_react@18.2.57_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/styles/styled.js";import c from"../node_modules/.pnpm/@mui_lab@5.0.0-alpha.165_@emotion_react@11.11.3_@emotion_styled@11.11.0_@mui_material@5.15.10_rj7nkmnq6xz32luabwnzcovv4q/node_modules/@mui/lab/LoadingButton/LoadingButton.js";const p=d(c)((()=>({backgroundColor:"rgba(34, 197, 94, 0.16)",color:"#118D57","&:hover":{backgroundColor:"rgba(34, 197, 94, 0.36)"}})));function f(d,c={}){const{onSubmit:f,formPrefix:_="",sx:g={},mode:j="onChange"}=c;let h={};const[b,y]=i("0"),v=m((()=>d),[d]);let x={};Object.entries(v).forEach((([e,o])=>{const{schema:t,defaultValue:r="",name:i=e,prefix:m=(_?[_]:""),fieldConfig:s={}}=o;let a=i;const{required:l}=s;if(m){let e="";e=Array.isArray(m)?[...m].join("."):m,h[e]||(h[e]={}),h[e][a]=r}else{let e=x,o=h,m=a.split(".");m.forEach(((s,a)=>{a!=m.length-1?(o[s]||(e[s]={},o[s]={}),e=e[s],o=o[s]):(o[s]=r,t&&(e[s]=t),l&&(e[s]?e[s]=e[s].required(i+" is required"):e[s]=n.string().required(i+" is required")))}))}}));let w=(e,o,t=null)=>{let r={...e};for(let e in r)"object"!=typeof r[e]||r[e]instanceof n.Schema||w(r[e],o?o+"."+e:e,r);if(o){let e=o.split(".");e.length>1?t[e.slice(-1)[0]]=n.object(r):x[e.slice(-1)[0]]=n.object(r)}};w(x,"",x);const C=n.object().shape(x),k=s({resolver:o(C),defaultValues:h,mode:j}),{watch:S,handleSubmit:q,formState:{isSubmitting:F}}=k,z=a(k),O=m((()=>Object.entries(v).map((([o,t])=>"custom"==t.type?t.customForm?.()||e.jsx(e.Fragment,{}):e.jsx(r.Fragment,{children:z(t.name||o,{prefix:_?[_]:"",...t})},o)))),[b,v]);return r.useEffect((()=>{const e=S(((e,o)=>{Object.entries(v).map((([t,r])=>{if(r.fieldConfig?.childFieldConfig)for(const t of Object.values(r.fieldConfig?.childFieldConfig))t.watch&&(t.watch?.({currentConfig:t,values:e,info:o,api:k}),y(l()));r.watch&&(r.watch?.({currentConfig:r,values:e,info:o,api:k}),y(l()))}))}));return()=>e.unsubscribe()}),[S,v]),{formNode:m((()=>e.jsx(u,{onSubmit:q((()=>{})),formRef:k,children:e.jsxs(t,{sx:g,spacing:3,children:[O,f&&e.jsx(p,{type:"submit",variant:"contained",size:"large",onClick:async()=>{const e=await k.trigger();f({isRight:e,values:k.getValues(),formRef:k})},loading:F,children:"Save"})]})})),[b,O]),methods:k}}export{f as useFields};
