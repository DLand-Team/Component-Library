import{j as e}from"../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{Box as r}from"@mui/material";import{useMemo as t,useRef as o,useEffect as s,useState as n}from"react";import{useFields as i}from"../../hooks/use-fields.js";import{useResponsive as a}from"../../hooks/use-responsive.js";import{processRecordLoop as m,Tree as l}from"../tree/tree.js";import"../iconify/iconify.js";import"../tree/styles.js";import d from"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/cloneDeep.js";import c from"../../node_modules/.pnpm/@mui_material@5.15.10_@emotion_react@11.11.3_@emotion_styled@11.11.0_@types_react@18.2.57_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Unstable_Grid2/Grid2.js";import u from"../../node_modules/.pnpm/@mui_material@5.15.10_@emotion_react@11.11.3_@emotion_styled@11.11.0_@types_react@18.2.57_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Card/Card.js";import f from"../../node_modules/.pnpm/@mui_material@5.15.10_@emotion_react@11.11.3_@emotion_styled@11.11.0_@types_react@18.2.57_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/CardHeader/CardHeader.js";import p from"../../node_modules/.pnpm/@mui_lab@5.0.0-alpha.165_@emotion_react@11.11.3_@emotion_styled@11.11.0_@mui_material@5.15.10_rj7nkmnq6xz32luabwnzcovv4q/node_modules/@mui/lab/LoadingButton/LoadingButton.js";const _=({formRef:e,id:r,formConfig:t})=>{const{formNode:o,methods:n}=i(t,{formId:r});return s((()=>{e.current[r]=n}),[]),o},j=(e,r)=>{r&&Object.entries(e).forEach((([e,t])=>{"checkbox"==t.type?t.defaultValue=!!r[e]:t.defaultValue=r[e]||t.defaultValue||""}))},h=({value:e={},transfer:r,baseData:o})=>t((()=>{if(e&&Object.values(e).length){e=r(d(e));const t=(e,r)=>{e?.formConfig&&j(e?.formConfig,r),e.sections&&e.sections.forEach((e=>{let o=r[e.name];"array"!==e.type?o&&t(e,o):(e.sections=[],Array.isArray(o)&&o.forEach((r=>{let{formConfig:t,...o}=e.formCreater();r&&j(t,r);let s={...o,active:!1,formConfig:t,onDelete:(e,r)=>{let t=r.findIndex((r=>r.id==e));r.splice(t,1)}};e.sections?.push(s)})))}))};t(o,e)}return o}),[e,o]);function y({handleClick:i,treeConfig:d,actionBtnArr:j,transferResult:y,transferInput:x,value:g}){const C=a("up","md"),b=o({}),v=h({value:g,transfer:x,baseData:d});s((()=>{k.current=v,I()}),[v]);let k=o(v);const[E,w]=n(v),D=t((()=>{let e={};return m(k.current,"0",e),e}),[E]),I=()=>{w({...k.current})},S=e.jsxs(e.Fragment,{children:[C&&e.jsx(c,{md:4,children:e.jsx(l,{record:D,update:I,treeRoot:E})}),e.jsx(c,{xs:12,md:8,children:e.jsxs(u,{children:[!C&&e.jsx(f,{title:"Details"}),Object.values(D).map((t=>{let o=t.isCurrent;return e.jsx(r,{style:o?{}:{display:"none"},children:t.formConfig&&e.jsx(_,{formRef:b,id:t.id,formConfig:t.formConfig})},t.id)}))]})})]}),O=e.jsxs(e.Fragment,{children:[C&&e.jsx(c,{md:4}),e.jsxs(c,{xs:12,md:12,sx:{display:"flex",alignItems:"center"},children:[e.jsx(r,{sx:{flex:1}}),j.map(((r,t)=>e.jsx(p,{sx:{mr:2},onClick:async()=>{const{isSuccess:e,result:t}=await(async()=>{let e={};const r=(e,t,o=0)=>{let s=b.current[o];if(s){Object.assign(e,s.getValues());for(let r in t.formConfig)t.formConfig[r].isNotInForm&&"array"!==t.type&&"object"!==t.type&&delete e[r]}t.sections?.length&&t.sections.forEach((t=>{if("array"==t.type){let o=e[t.name||t.label]=[];t.sections?.forEach((e=>{let t={};r(t,e,e.id),o.push(t)}))}else{if(t.judeShow&&!t.judeShow())return;let o=e[t.name||t.label]={};r(o,t,t.id)}}))};r(e,E);let t=!0;for(let e in D)if(b.current[e]){const r=await(b.current[e]?.trigger());D[e].isError=!r,r||(t=!1),I()}return y?.(e),{isSuccess:t,result:e}})();i({type:r.name,isSuccess:e,result:t})},type:"submit",variant:"contained",size:"large",children:r.name},t)))]})]});return e.jsxs(c,{container:!0,children:[S,O]})}export{y as TreeForm,j as setDefault,h as useCreateTreeData};
