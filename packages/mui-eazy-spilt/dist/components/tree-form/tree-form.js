import{j as e}from"../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{Box as t}from"@mui/material";import{useMemo as r,useRef as o,useEffect as s,useState as n}from"react";import{useFields as i}from"../../hooks/use-fields.js";import{useResponsive as a}from"../../hooks/use-responsive.js";import{processRecordLoop as m,Tree as l}from"../tree/tree.js";import"../../node_modules/.pnpm/@iconify_react@4.1.1_react@18.2.0/node_modules/@iconify/react/dist/iconify.js";import"../tree/styles.js";import d from"../../node_modules/.pnpm/lodash-es@4.17.21/node_modules/lodash-es/cloneDeep.js";import c from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Unstable_Grid2/Grid2.js";import u from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/Card/Card.js";import f from"../../node_modules/.pnpm/@mui_material@5.15.5_@emotion_react@11.5.0_@emotion_styled@11.6.0_@types_react@18.2.51_react-dom@18.2.0_react@18.2.0/node_modules/@mui/material/CardHeader/CardHeader.js";import _ from"../../node_modules/.pnpm/@mui_lab@5.0.0-alpha.142_@emotion_react@11.5.0_@emotion_styled@11.6.0_@mui_material@5.15.5_@t_qlw3gtmosftpd3vouevelhzhaq/node_modules/@mui/lab/LoadingButton/LoadingButton.js";const p=({formRef:e,id:t,formConfig:r})=>{const{formNode:o,methods:n}=i(r,{formId:t});return s((()=>{e.current[t]=n}),[]),o},j=(e,t)=>{t&&Object.entries(e).forEach((([e,r])=>{"checkbox"==r.type?r.defaultValue=!!t[e]:r.defaultValue=t[e]||r.defaultValue||""}))},h=({value:e={},transfer:t,baseData:o})=>r((()=>{if(e&&Object.values(e).length){e=t(d(e));const r=(e,t)=>{e?.formConfig&&j(e?.formConfig,t),e.sections&&e.sections.forEach((e=>{let o=t[e.name];"array"!==e.type?o&&r(e,o):(e.sections=[],Array.isArray(o)&&o.forEach((t=>{let{formConfig:r,...o}=e.formCreater();t&&j(r,t);let s={...o,active:!1,formConfig:r,onDelete:(e,t)=>{let r=t.findIndex((t=>t.id==e));t.splice(r,1)}};e.sections?.push(s)})))}))};r(o,e)}return o}),[e,o]);function y({handleClick:i,treeConfig:d,actionBtnArr:j,transferResult:y,transferInput:x,value:g}){const C=a("up","md"),b=o({}),v=h({value:g,transfer:x,baseData:d});s((()=>{E.current=v,I()}),[v]);let E=o(v);const[k,w]=n(v),D=r((()=>{let e={};return m(E.current,"0",e),e}),[k]),I=()=>{w({...E.current})},S=e.jsxs(e.Fragment,{children:[C&&e.jsx(c,{md:4,children:e.jsx(l,{record:D,update:I,treeRoot:k})}),e.jsx(c,{xs:12,md:8,children:e.jsxs(u,{children:[!C&&e.jsx(f,{title:"Details"}),Object.values(D).map((r=>{let o=r.isCurrent;return e.jsx(t,{style:o?{}:{display:"none"},children:r.formConfig&&e.jsx(p,{formRef:b,id:r.id,formConfig:r.formConfig})},r.id)}))]})})]}),O=e.jsxs(e.Fragment,{children:[C&&e.jsx(c,{md:4}),e.jsxs(c,{xs:12,md:12,sx:{display:"flex",alignItems:"center"},children:[e.jsx(t,{sx:{flex:1}}),j.map(((t,r)=>e.jsx(_,{sx:{mr:2},onClick:async()=>{const{isSuccess:e,result:r}=await(async()=>{let e={};const t=(e,r,o=0)=>{let s=b.current[o];if(s){Object.assign(e,s.getValues());for(let t in r.formConfig)r.formConfig[t].isNotInForm&&"array"!==r.type&&"object"!==r.type&&delete e[t]}r.sections?.length&&r.sections.forEach((r=>{if("array"==r.type){let o=e[r.name||r.label]=[];r.sections?.forEach((e=>{let r={};t(r,e,e.id),o.push(r)}))}else{if(r.judeShow&&!r.judeShow())return;let o=e[r.name||r.label]={};t(o,r,r.id)}}))};t(e,k);let r=!0;for(let e in D)if(b.current[e]){const t=await(b.current[e]?.trigger());D[e].isError=!t,t||(r=!1),I()}return y?.(e),{isSuccess:r,result:e}})();i({type:t.name,isSuccess:e,result:r})},type:"submit",variant:"contained",size:"large",children:t.name},r)))]})]});return e.jsxs(c,{container:!0,children:[S,O]})}export{y as TreeForm,j as setDefault,h as useCreateTreeData};
