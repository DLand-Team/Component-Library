import{j as i}from"../../node_modules/.pnpm/react@18.2.0/node_modules/react/jsx-runtime.js";import{Box as e,IconButton as t,Collapse as o}from"@mui/material";import{useRef as r,useState as n}from"react";import{Iconify as s}from"../iconify/iconify.js";import{uuidv4 as c}from"../../utils/uuidv4.js";import{TreeItem as d}from"./tree-item.js";const a=e=>{const{isAdd:r,formConfig:c,parentSections:l,isCurrent:p,record:u,sections:m,update:x,onDelete:f,onAdd:h,judeShow:j,...w}=e,[v,g]=n(!0);return j&&!j()?i.jsx(i.Fragment,{}):i.jsxs(i.Fragment,{children:[i.jsxs(d,{onClick:()=>{if(e.formConfig){for(let i in u)u[i].active=!1,u[i].isCurrent=!1;u[e.id].active=!0,u[e.id].isCurrent=!0;let i=e.id?.split("_").slice(0,-1)||[];i?.length>1&&i.forEach(((i,t)=>{let o=e.id?.split("_").slice(0,t+1).join("_");o&&"0"!=o&&(u[o].active=!0)})),x?.()}else if(e.onSwitch){for(let i in u)u[i].active=!1,u[i].isCurrent=!1;u[e.id].active=!0,u[e.id].isCurrent=!0,e.onSwitch(e.id)}"0"==e.id?g(!0):m&&g(!v)},...w,children:[r&&i.jsx(t,{style:{zIndex:10},onClick:i=>{i.stopPropagation(),e.active||g(!0),m&&h(m),x?.()},sx:{position:"absolute",right:"40px"},children:i.jsx(s,{width:16,icon:"icon-park-outline:add"})}),"array"==u[e.id?.split("_").slice(0,-1).join("_")]?.type&&i.jsx(t,{style:{zIndex:10},onClick:i=>{if(i.stopPropagation(),u[e.id].active){for(let i in u)u[i].active=!1;u[0].active=!0}f(e.id,l),x?.()},sx:{position:"absolute",right:"40px"},children:i.jsx(s,{width:16,icon:"icon-park-outline:delete"})}),!!m&&"0"!==e.id&&i.jsx(s,{width:16,icon:v?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill",sx:{position:"absolute",right:"20px"}})]}),!!m&&i.jsx(o,{in:v,children:m?.map(((t,o)=>{const{label:r,parentId:n,onDelete:s,...c}=t;return i.jsx("div",{children:i.jsx(a,{onSwitch:e.onSwitch,onDelete:s,parentSections:s?m:null,update:x,record:u,...c,label:"array"==u[n]?.type?`${r}-${o}`:r})},t.id)}))})]})},l=(i,e,t)=>{e||(e=c()),"0"==e&&(t[e]=i),i.id=e;const{sections:o}=i;o&&o.map((i=>{i.parentId=e;let o=i.id||`${e}_${c()}`;l(i,o,t),t[o]=i}))},p=t=>{const{treeRoot:o,update:s,record:c,onSwitch:d,...p}=t;let u=o,m=c,x=r({});const[f,h]=n(Date.now());return c||(m=x.current,l(u,"0",m)),i.jsx(e,{...p,children:i.jsx(a,{onSwitch:i=>{d?.(i,m),h(Date.now())},update:s,record:m,...u})})};export{p as Tree,l as processRecordLoop};
